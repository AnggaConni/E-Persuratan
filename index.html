<!-- 
    =============================================
    E-PERSURATAN GOV SYSTEM MOCKUP
    Developed by: Angga Conni Saputra
    =============================================
-->
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem E-Persuratan Terpadu</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- SheetJS & jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; }
        
        .glass-panel { 
            background: white; 
            border: 1px solid #e5e7eb; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); 
            border-radius: 0.75rem; 
        }

        /* Status Badges */
        .status-draft { @apply bg-gray-100 text-gray-600 border-gray-200; }
        .status-sent { @apply bg-blue-50 text-blue-600 border-blue-100; }
        .status-received { @apply bg-green-50 text-green-600 border-green-100; }
        .status-disposition { @apply bg-purple-50 text-purple-600 border-purple-100; }
        .status-done { @apply bg-slate-800 text-white border-slate-900; }
        .status-archived { @apply bg-yellow-50 text-yellow-700 border-yellow-100; }

        /* Calendar Styles */
        .cal-day { @apply w-10 h-10 flex flex-col items-center justify-center rounded-lg text-sm cursor-pointer hover:bg-blue-50 transition relative font-medium text-gray-600; }
        .cal-day.active { @apply bg-blue-600 text-white shadow-md hover:bg-blue-700; }
        .cal-day.has-data::after { content: ''; @apply w-1.5 h-1.5 bg-blue-400 rounded-full absolute bottom-1; }
        .cal-day.active::after { @apply bg-white; }
        
        /* Modal Animation */
        .modal-enter { animation: zoomIn 0.2s ease-out; }
        @keyframes zoomIn { from { opacity: 0; transform: translate(-50%, -50%) scale(0.95); } to { opacity: 1; transform: translate(-50%, -50%) scale(1); } }
    </style>
</head>
<body class="text-slate-800 pb-20 relative">

    <!-- NAVBAR -->
    <nav class="bg-slate-900 text-white sticky top-0 z-40 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-600 w-10 h-10 rounded-lg flex items-center justify-center shadow-lg shadow-blue-900/50">
                        <i class="fa-solid fa-layer-group text-white text-lg"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="font-bold text-lg tracking-tight leading-tight">E-Persuratan <span class="text-blue-400 font-light">Gov v3.5</span></span>
                        <span class="text-[10px] text-gray-400 tracking-wide font-medium">Develop by - Angga Conni Saputra</span>
                    </div>
                </div>
                
                <div class="flex items-center gap-6">
                    <!-- Language Switcher -->
                    <div class="flex bg-slate-800 p-1 rounded-lg border border-slate-700">
                        <button onclick="changeLanguage('id')" id="btn-lang-id" class="px-2 py-0.5 text-[10px] font-bold rounded bg-blue-600 text-white transition">ID</button>
                        <button onclick="changeLanguage('en')" id="btn-lang-en" class="px-2 py-0.5 text-[10px] font-bold rounded text-gray-400 hover:text-white transition">EN</button>
                    </div>

                    <div class="hidden md:block text-right border-l border-slate-700 pl-6">
                        <div class="text-xs text-gray-400" data-i18n="login_as">Login sebagai</div>
                        <div class="text-sm font-semibold">Administrator</div>
                    </div>
                    <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center border border-gray-600">
                        <i class="fa-solid fa-user-shield text-xs text-blue-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <div class="max-w-[95%] mx-auto px-2 sm:px-4 lg:px-6 py-8">
        
        <!-- DASHBOARD CHART SECTION -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Chart Container -->
            <div class="lg:col-span-2 glass-panel p-5">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-gray-700 flex items-center">
                        <i class="fa-solid fa-chart-line mr-2 text-blue-600"></i>
                        <span data-i18n="chart_title">Statistik Lalu Lintas Surat</span>
                    </h3>
                    <select id="chartFilter" onchange="renderChart()" class="text-xs border rounded p-1 bg-gray-50">
                        <option value="6" data-i18n="last_6_months">6 Bulan Terakhir</option>
                        <option value="12" data-i18n="last_1_year">1 Tahun Terakhir</option>
                    </select>
                </div>
                <div class="relative h-64 w-full">
                    <canvas id="trafficChart"></canvas>
                </div>
            </div>

            <!-- Mini Stats -->
            <div class="lg:col-span-1 grid grid-cols-1 gap-4">
                <div class="glass-panel p-4 border-l-4 border-blue-500 flex justify-between items-center">
                    <div>
                        <div class="text-gray-500 text-xs font-bold uppercase" data-i18n="total_archives">Total Arsip</div>
                        <div class="text-3xl font-bold mt-1" id="stat-total">0</div>
                    </div>
                    <i class="fa-solid fa-database text-blue-200 text-4xl"></i>
                </div>
                <div class="glass-panel p-4 border-l-4 border-yellow-400 flex justify-between items-center">
                    <div>
                        <div class="text-gray-500 text-xs font-bold uppercase" data-i18n="incoming_mail">Surat Masuk</div>
                        <div class="text-3xl font-bold mt-1 text-yellow-600" id="stat-in">0</div>
                    </div>
                    <i class="fa-solid fa-inbox text-yellow-200 text-4xl"></i>
                </div>
                <div class="glass-panel p-4 border-l-4 border-slate-700 flex justify-between items-center">
                    <div>
                        <div class="text-gray-500 text-xs font-bold uppercase" data-i18n="outgoing_mail">Surat Keluar</div>
                        <div class="text-3xl font-bold mt-1 text-slate-700" id="stat-out">0</div>
                    </div>
                    <i class="fa-solid fa-paper-plane text-slate-200 text-4xl"></i>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-4 gap-8">
            
            <!-- LEFT COLUMN: INPUT FORM -->
            <div class="xl:col-span-1 space-y-6">
                <div class="glass-panel p-6 sticky top-24">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-lg font-bold text-gray-800 flex items-center">
                            <span class="bg-blue-100 text-blue-700 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">1</span>
                            <span data-i18n="input_title">Input Surat</span>
                        </h2>
                        <button onclick="resetDatabase()" class="text-xs text-red-400 hover:text-red-600 underline" data-i18n="reset_demo">Reset Demo</button>
                    </div>

                    <form id="suratForm" onsubmit="handleSimpan(event)" class="space-y-4">
                        <!-- Form Inputs -->
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1" data-i18n="direction">Arah</label>
                                <select id="inputArah" required class="w-full p-2 bg-gray-50 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none text-xs">
                                    <option value="Masuk">‚¨á Masuk</option>
                                    <option value="Keluar">‚¨Ü Keluar</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1" data-i18n="category">Kategori</label>
                                <select id="inputKategori" onchange="updateJenisOptions()" class="w-full p-2 bg-gray-50 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none text-xs">
                                    <option value="" disabled selected>--</option>
                                    <option value="Finance">Finance</option>
                                    <option value="Travel">Travel</option>
                                    <option value="Admin">Admin</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1" data-i18n="doc_type">Jenis Dokumen</label>
                            <select id="inputJenis" disabled class="w-full p-2 bg-gray-100 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none text-xs disabled:cursor-not-allowed">
                                <option value="">...</option>
                            </select>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1" data-i18n="sender">Dari</label>
                                <input type="text" id="inputDari" required placeholder="PT..." class="w-full p-2 bg-gray-50 border border-gray-300 rounded outline-none text-xs">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1" data-i18n="receiver">Kepada</label>
                                <input type="text" id="inputKepada" required placeholder="Div..." class="w-full p-2 bg-gray-50 border border-gray-300 rounded outline-none text-xs">
                            </div>
                        </div>

                        <div>
                            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1" data-i18n="letter_date">Tanggal Surat</label>
                            <input type="date" id="inputTanggal" required class="w-full p-2 bg-gray-50 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none text-xs">
                        </div>

                        <div>
                            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1" data-i18n="subject">Perihal</label>
                            <textarea id="inputPerihal" rows="2" required class="w-full p-2 bg-gray-50 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none text-xs"></textarea>
                        </div>

                         <div>
                            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1" data-i18n="attachment">Lampiran (Upload)</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-3 text-center hover:bg-blue-50 hover:border-blue-300 transition cursor-pointer" onclick="alert('Simulasi: File terupload ke server (Mockup).')">
                                <div class="flex flex-col items-center gap-1">
                                    <i class="fa-solid fa-cloud-arrow-up text-blue-400 text-lg"></i>
                                    <span class="text-[10px] text-gray-400">Klik/Drop File PDF</span>
                                </div>
                            </div>
                        </div>

                         <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1" data-i18n="status">Status</label>
                                <select id="inputStatus" class="w-full p-2 bg-gray-50 border border-gray-300 rounded outline-none text-xs">
                                    <option value="Draft">Draft</option>
                                    <option value="Sent">Sent</option>
                                    <option value="Received">Received</option>
                                    <option value="Done">Done</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1" data-i18n="unit">Unit</label>
                                <input type="text" id="inputUnit" value="Sekretariat" class="w-full p-2 bg-gray-50 border border-gray-300 rounded outline-none text-xs">
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-2.5 px-4 rounded-lg shadow-lg hover:shadow-xl transition transform active:scale-95 flex justify-center items-center gap-2 text-xs">
                            <i class="fa-solid fa-save"></i> <span data-i18n="btn_save">Simpan Data</span>
                        </button>
                    </form>
                </div>
            </div>

            <!-- RIGHT COLUMN: TABLE DATA -->
            <div class="xl:col-span-3">
                <div class="glass-panel p-6 min-h-[600px] flex flex-col">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                        <div class="flex items-center gap-4">
                            <h2 class="text-lg font-bold text-gray-800 flex items-center">
                                <span class="bg-green-100 text-green-700 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">2</span>
                                <span data-i18n="archive_title">Arsip Digital</span>
                            </h2>
                            
                            <!-- CALENDAR WIDGET BUTTON -->
                            <button onclick="toggleCalendarModal()" class="flex items-center gap-2 bg-white border border-gray-200 text-gray-600 px-3 py-1.5 rounded-lg shadow-sm hover:border-blue-400 hover:text-blue-600 transition text-xs font-medium group active:scale-95">
                                <div class="bg-blue-50 text-blue-600 w-6 h-6 rounded flex items-center justify-center group-hover:bg-blue-600 group-hover:text-white transition">
                                   <i class="fa-regular fa-calendar-check"></i>
                                </div>
                                <span id="calWidgetLabel">Filter Tanggal</span>
                            </button>
                        </div>
                        
                        <div class="flex gap-2">
                            <button onclick="exportExcel()" class="bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-2 px-4 rounded shadow flex items-center gap-2 transition">
                                <i class="fa-solid fa-file-excel"></i> XLSX
                            </button>
                            <button onclick="exportPDF()" class="bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-2 px-4 rounded shadow flex items-center gap-2 transition">
                                <i class="fa-solid fa-file-pdf"></i> PDF
                            </button>
                        </div>
                    </div>

                    <!-- ADVANCED FILTERS -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-2 mb-4 bg-gray-50 p-3 rounded-lg border border-gray-200">
                        <div class="md:col-span-1">
                            <input type="text" id="searchInput" onkeyup="resetPaginationAndRender()" placeholder="üîç Cari..." class="w-full p-2 bg-white border border-gray-300 rounded text-sm focus:outline-none focus:border-blue-400">
                        </div>
                        <div>
                            <select id="filterArah" onchange="resetPaginationAndRender()" class="w-full p-2 bg-white border border-gray-300 rounded text-sm outline-none">
                                <option value="All" data-i18n="filter_all_dir">Semua Arah</option>
                                <option value="Masuk">‚¨á Masuk</option>
                                <option value="Keluar">‚¨Ü Keluar</option>
                            </select>
                        </div>
                        <div>
                            <select id="filterStatus" onchange="resetPaginationAndRender()" class="w-full p-2 bg-white border border-gray-300 rounded text-sm outline-none">
                                <option value="All" data-i18n="filter_all_stat">Semua Status</option>
                                <option value="Draft">Draft</option>
                                <option value="Sent">Sent</option>
                                <option value="Received">Received</option>
                                <option value="Done">Done</option>
                            </select>
                        </div>
                        <div>
                             <select id="filterKategori" onchange="resetPaginationAndRender()" class="w-full p-2 bg-white border border-gray-300 rounded text-sm outline-none">
                                <option value="All" data-i18n="filter_all_cat">Semua Kategori</option>
                                <option value="Finance">Finance</option>
                                <option value="Travel">Travel</option>
                                <option value="Admin">Admin</option>
                            </select>
                        </div>
                    </div>

                    <!-- Table Container -->
                    <div class="overflow-x-auto flex-grow rounded-lg border border-gray-200 min-h-[400px]">
                        <table class="min-w-full text-sm text-left divide-y divide-gray-200">
                            <thead class="bg-gray-50 text-xs text-gray-500 uppercase font-semibold sticky top-0 bg-gray-50 z-10">
                                <tr>
                                    <th class="px-4 py-3 text-center whitespace-nowrap" data-i18n="col_dir">Arah</th>
                                    <th class="px-4 py-3 whitespace-nowrap" data-i18n="col_no">Nomor Surat</th>
                                    <th class="px-4 py-3 text-center whitespace-nowrap" data-i18n="col_date">Tgl Surat</th>
                                    <th class="px-4 py-3 whitespace-nowrap" data-i18n="col_subj">Perihal</th>
                                    <th class="px-4 py-3 whitespace-nowrap" data-i18n="col_type">Jenis</th>
                                    <th class="px-4 py-3 text-center whitespace-nowrap" data-i18n="col_file">File</th> <!-- NEW -->
                                    <th class="px-4 py-3 text-center whitespace-nowrap" data-i18n="col_status">Status</th>
                                    <th class="px-4 py-3 text-center whitespace-nowrap" data-i18n="col_action">Edit</th> <!-- NEW -->
                                </tr>
                            </thead>
                            <tbody id="dataTableBody" class="divide-y divide-gray-100 bg-white">
                                <!-- Data rendered by JS -->
                            </tbody>
                        </table>
                        
                        <!-- Empty State -->
                        <div id="emptyState" class="hidden flex-col items-center justify-center py-12 text-center">
                            <div class="bg-gray-100 rounded-full w-16 h-16 flex items-center justify-center mb-3">
                                <i class="fa-solid fa-filter text-gray-400 text-2xl"></i>
                            </div>
                            <h3 class="text-gray-600 font-medium" data-i18n="no_data">Data tidak ditemukan</h3>
                            <div id="dateFilterMsg" class="mt-2 hidden">
                                <span class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded">Filter Tanggal Aktif</span>
                                <button onclick="clearDateFilter()" class="ml-2 text-xs text-red-500 hover:underline">Hapus Filter</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PAGINATION CONTROLS -->
                    <div class="mt-4 flex flex-col sm:flex-row justify-between items-center gap-4 text-sm text-gray-600 bg-gray-50 p-3 rounded border border-gray-200">
                        <div class="flex items-center gap-2">
                            <span data-i18n="show_rows">Tampilkan:</span>
                            <select id="rowsPerPage" onchange="changeRowsPerPage()" class="bg-white border border-gray-300 rounded px-2 py-1 outline-none text-sm">
                                <option value="20">20</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                            <span data-i18n="per_page">data/halaman</span>
                        </div>

                        <div class="flex items-center gap-4">
                            <span id="paginationInfo">Showing 1-20 of 150</span>
                            <div class="flex gap-1">
                                <button id="btnPrev" onclick="changePage(-1)" class="px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition">
                                    <i class="fa-solid fa-chevron-left"></i>
                                </button>
                                <button id="btnNext" onclick="changePage(1)" class="px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 1. MODAL CALENDAR -->
    <div id="calendarModal" class="fixed inset-0 z-50 hidden" onclick="if(event.target === this) toggleCalendarModal()">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-2xl p-6 w-full max-w-md modal-enter relative z-10">
            <div class="flex justify-between items-center mb-6 border-b pb-4">
                <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                    <i class="fa-regular fa-calendar-check text-blue-600"></i>
                    <span data-i18n="calendar_title">Filter Tanggal</span>
                </h3>
                <div class="flex items-center gap-3">
                    <button onclick="clearDateFilter()" class="text-xs text-red-500 hover:text-red-700 font-medium hover:underline">
                        <i class="fa-solid fa-trash mr-1"></i> Reset
                    </button>
                    <button onclick="toggleCalendarModal()" class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition">
                        <i class="fa-solid fa-times text-gray-500"></i>
                    </button>
                </div>
            </div>
            <div class="bg-white">
                <div class="cal-header flex justify-between items-center mb-4">
                    <button onclick="changeMonth(-1)" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 text-gray-500 transition"><i class="fa-solid fa-chevron-left"></i></button>
                    <span id="calMonthYear" class="text-blue-900 font-bold uppercase tracking-wide text-sm">February 2026</span>
                    <button onclick="changeMonth(1)" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 text-gray-500 transition"><i class="fa-solid fa-chevron-right"></i></button>
                </div>
                <div class="grid grid-cols-7 gap-1 text-center mb-2">
                    <div class="text-xs font-bold text-gray-400">Su</div><div class="text-xs font-bold text-gray-400">Mo</div><div class="text-xs font-bold text-gray-400">Tu</div><div class="text-xs font-bold text-gray-400">We</div><div class="text-xs font-bold text-gray-400">Th</div><div class="text-xs font-bold text-gray-400">Fr</div><div class="text-xs font-bold text-gray-400">Sa</div>
                </div>
                <div id="calendarGrid" class="grid grid-cols-7 gap-2"></div>
                <div class="mt-4 flex items-center justify-center gap-2 text-xs text-gray-400 pt-4 border-t">
                    <span class="w-2 h-2 rounded-full bg-blue-400"></span><span data-i18n="cal_legend">Menandakan ada arsip surat pada tanggal tersebut</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. MODAL VIEW DETAIL -->
    <div id="viewModal" class="fixed inset-0 z-50 hidden" onclick="if(event.target === this) closeViewModal()">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-2xl p-0 w-full max-w-2xl modal-enter relative z-10 overflow-hidden">
            <div class="bg-blue-900 p-6 flex justify-between items-center text-white">
                <h3 class="text-lg font-bold flex items-center gap-2"><i class="fa-solid fa-circle-info"></i> Detail Arsip</h3>
                <button onclick="closeViewModal()" class="hover:bg-blue-800 rounded-full w-8 h-8 flex items-center justify-center transition"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="p-6 space-y-4 max-h-[70vh] overflow-y-auto" id="viewModalContent">
                <!-- Content injected by JS -->
            </div>
            <div class="bg-gray-50 p-4 border-t border-gray-200 flex justify-end">
                <button onclick="closeViewModal()" class="bg-slate-200 hover:bg-slate-300 text-slate-700 px-4 py-2 rounded text-sm font-semibold transition">Tutup</button>
            </div>
        </div>
    </div>

    <!-- 3. MODAL EDIT/REVISI -->
    <div id="editModal" class="fixed inset-0 z-50 hidden" onclick="if(event.target === this) closeEditModal()">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-2xl p-0 w-full max-w-lg modal-enter relative z-10 overflow-hidden">
            <div class="bg-amber-500 p-5 flex justify-between items-center text-white">
                <h3 class="text-lg font-bold flex items-center gap-2"><i class="fa-solid fa-pen-to-square"></i> Revisi Data</h3>
                <button onclick="closeEditModal()" class="hover:bg-amber-600 rounded-full w-8 h-8 flex items-center justify-center transition"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[70vh]">
                <form id="editForm" class="space-y-4">
                    <input type="hidden" id="editId">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Perihal</label>
                        <textarea id="editPerihal" rows="2" class="w-full p-2 bg-gray-50 border border-gray-300 rounded focus:ring-2 focus:ring-amber-500 outline-none text-sm"></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Dari</label>
                            <input type="text" id="editDari" class="w-full p-2 bg-gray-50 border border-gray-300 rounded text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Kepada</label>
                            <input type="text" id="editKepada" class="w-full p-2 bg-gray-50 border border-gray-300 rounded text-sm">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Status</label>
                            <select id="editStatus" class="w-full p-2 bg-gray-50 border border-gray-300 rounded text-sm">
                                <option value="Draft">Draft</option><option value="Sent">Sent</option><option value="Received">Received</option><option value="Done">Done</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">File Attachment</label>
                            <select id="editFileStatus" class="w-full p-2 bg-gray-50 border border-gray-300 rounded text-sm">
                                <option value="true">‚úÖ Ada File</option>
                                <option value="false">‚ùå Belum Ada</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="bg-gray-50 p-4 border-t border-gray-200 flex justify-end gap-2">
                <button onclick="closeEditModal()" class="text-gray-500 hover:text-gray-700 px-4 py-2 text-sm font-medium">Batal</button>
                <button onclick="saveEditData()" class="bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded text-sm font-bold shadow transition">Simpan Perubahan</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- 1. CONFIG ---
        const TRANSLATIONS = {
            app_title: { id: 'E-Persuratan <span class="text-blue-400 font-light">Gov v3.5</span>', en: 'E-Correspondence <span class="text-blue-400 font-light">Gov v3.5</span>' },
            login_as: { id: "Login sebagai", en: "Logged in as" },
            chart_title: { id: "Statistik Lalu Lintas Surat", en: "Mail Traffic Statistics" },
            last_6_months: { id: "6 Bulan Terakhir", en: "Last 6 Months" },
            last_1_year: { id: "1 Tahun Terakhir", en: "Last 1 Year" },
            total_archives: { id: "Total Arsip", en: "Total Archives" },
            incoming_mail: { id: "Surat Masuk", en: "Incoming Mail" },
            outgoing_mail: { id: "Surat Keluar", en: "Outgoing Mail" },
            input_title: { id: "Input Surat", en: "New Entry" },
            reset_demo: { id: "Reset Demo", en: "Reset Demo" },
            direction: { id: "Arah", en: "Direction" },
            category: { id: "Kategori", en: "Category" },
            doc_type: { id: "Jenis Dokumen", en: "Document Type" },
            sender: { id: "Dari (Pengirim)", en: "From (Sender)" },
            receiver: { id: "Kepada (Penerima)", en: "To (Receiver)" },
            letter_date: { id: "Tanggal Surat", en: "Letter Date" },
            subject: { id: "Perihal", en: "Subject" },
            attachment: { id: "Lampiran (Upload)", en: "Attachment (Upload)" },
            status: { id: "Status", en: "Status" },
            unit: { id: "Unit Pengelola", en: "Managing Unit" },
            btn_save: { id: "Simpan Data", en: "Save Record" },
            calendar_filter: { id: "Filter Tanggal", en: "Date Filter" },
            calendar_title: { id: "Pilih Tanggal Filter", en: "Select Filter Date" },
            cal_legend: { id: "Ada Arsip Surat", en: "Contains Records" },
            archive_title: { id: "Arsip Digital", en: "Digital Archive" },
            filter_all_dir: { id: "Semua Arah", en: "All Directions" },
            filter_all_stat: { id: "Semua Status", en: "All Status" },
            filter_all_cat: { id: "Semua Kategori", en: "All Categories" },
            no_data: { id: "Data tidak ditemukan", en: "No data found" },
            show_rows: { id: "Tampilkan:", en: "Show:" },
            per_page: { id: "data/halaman", en: "rows/page" },
            col_dir: { id: "Arah", en: "Dir" },
            col_no: { id: "Nomor Surat", en: "Ref Number" },
            col_date: { id: "Tgl Surat", en: "Date" },
            col_subj: { id: "Perihal", en: "Subject" },
            col_type: { id: "Jenis", en: "Type" },
            col_file: { id: "File", en: "File" }, // NEW
            col_status: { id: "Status", en: "Status" },
            col_action: { id: "Edit", en: "Edit" } // NEW
        };

        const DOC_CONFIG = {
            'Finance': [ { name: 'Payment Request', code: 'PR' }, { name: 'Invoice Masuk', code: 'INV' }, { name: 'Petty Cash', code: 'PC' }, { name: 'Purchase Request', code: 'PO' } ],
            'Travel': [ { name: 'Visa Support Letter', code: 'VISA' }, { name: 'Airport Handling', code: 'AH' }, { name: 'Surat Perjalanan Dinas', code: 'SPD' }, { name: 'Note Verbale (MOFA)', code: 'NV' } ],
            'Admin': [ { name: 'Surat Keputusan (SK)', code: 'SK' }, { name: 'Surat Undangan', code: 'UND' }, { name: 'Berita Acara', code: 'BA' }, { name: 'Nota Dinas Internal', code: 'ND' } ]
        };

        let currentLang = 'id';
        let currentPage = 1;
        let rowsPerPage = 20;
        let db_surat = JSON.parse(localStorage.getItem('db_surat_v35')) || []; // Changed key to v35 for update
        let calDate = new Date();
        let activeFilterDate = null;

        // --- 2. DATA GENERATOR (UPDATED) ---
        function generateDummyData() {
            const categories = ['Finance', 'Travel', 'Admin'];
            const arahOpts = ['Masuk', 'Keluar'];
            const units = ['Biro Umum', 'Divisi IT', 'Sekretariat', 'HRD', 'Keuangan'];
            const senders = ['Kementerian Luar Negeri', 'PT. Angkasa Pura', 'Vendor Catering A', 'Kedutaan Besar Jepang', 'Direktur Utama', 'KPK', 'Bappenas'];
            const receivers = ['Kepala Biro', 'Manager Finance', 'Staff Protokol', 'Tim Pengadaan', 'Direktur', 'Kasubag RT'];
            const statuses = ['Draft', 'Sent', 'Received', 'Disposisi', 'Done', 'Archived'];
            const subjects = ['Permohonan Dana', 'Undangan Rapat', 'Laporan Bulanan', 'Pengajuan Visa', 'Tagihan Vendor', 'Surat Tugas', 'Berita Acara', 'Undangan Pernikahan'];
            
            const today = new Date();
            db_surat = [];

            for(let i=0; i<150; i++) {
                const randomMonth = Math.floor(Math.random() * 6);
                const date = new Date(today.getFullYear(), today.getMonth() - randomMonth, Math.floor(Math.random() * 28) + 1);
                const cat = categories[Math.floor(Math.random() * categories.length)];
                const typeConfig = DOC_CONFIG[cat][Math.floor(Math.random() * DOC_CONFIG[cat].length)];
                
                db_surat.push({
                    id: Date.now() + i,
                    nomor: `${typeConfig.code}/${getRomanMonth(date)}/${date.getFullYear()}/${(Math.floor(Math.random()*99)+1).toString().padStart(3,'0')}`,
                    kategori: cat, jenis: typeConfig.name, 
                    arah: arahOpts[Math.floor(Math.random() * arahOpts.length)],
                    tanggal: date.toISOString().split('T')[0],
                    perihal: subjects[Math.floor(Math.random() * subjects.length)] + " " + (i+1),
                    dari: senders[Math.floor(Math.random() * senders.length)],
                    kepada: receivers[Math.floor(Math.random() * receivers.length)],
                    status: statuses[Math.floor(Math.random() * statuses.length)],
                    unit: units[Math.floor(Math.random() * units.length)],
                    hasFile: Math.random() > 0.2 // 80% chance of file
                });
            }
            db_surat.sort((a,b) => new Date(b.tanggal) - new Date(a.tanggal));
            localStorage.setItem('db_surat_v35', JSON.stringify(db_surat));
        }

        if(db_surat.length === 0) generateDummyData();
        let myChart = null;

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('inputTanggal').valueAsDate = new Date();
            renderTable(); renderChart(); updateMiniWidgetLabel();
        });

        // --- HELPER ---
        function getRomanMonth(date) { return ["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII"][date.getMonth()]; }
        function getRomanMonthStr(dateStr) { return getRomanMonth(new Date(dateStr)); }
        function generateNomorSurat(kategori, jenisName, dateStr) {
            let prefix = "GEN";
            const configList = DOC_CONFIG[kategori];
            const found = configList.find(item => item.name === jenisName);
            if(found) prefix = found.code;
            const year = new Date(dateStr).getFullYear();
            const romawi = getRomanMonthStr(dateStr);
            const currentCount = db_surat.filter(s => s.nomor.startsWith(prefix) && s.tanggal.startsWith(year)).length;
            return `${prefix}/${romawi}/${year}/${(currentCount + 1).toString().padStart(3, '0')}`;
        }
        function updateJenisOptions() {
            const kategori = document.getElementById('inputKategori').value;
            const jenisSelect = document.getElementById('inputJenis');
            jenisSelect.innerHTML = '<option value="">-- Pilih --</option>';
            jenisSelect.disabled = false;
            if (DOC_CONFIG[kategori]) {
                DOC_CONFIG[kategori].forEach(doc => {
                    const opt = document.createElement('option');
                    opt.value = doc.name; opt.dataset.code = doc.code; opt.innerText = doc.name;
                    jenisSelect.appendChild(opt);
                });
            }
        }

        // --- MODAL LOGIC (EDIT & VIEW) ---
        function openEditModal(id) {
            const item = db_surat.find(s => s.id === id);
            if(!item) return;
            document.getElementById('editId').value = item.id;
            document.getElementById('editPerihal').value = item.perihal;
            document.getElementById('editDari').value = item.dari;
            document.getElementById('editKepada').value = item.kepada;
            document.getElementById('editStatus').value = item.status;
            document.getElementById('editFileStatus').value = item.hasFile;
            document.getElementById('editModal').classList.remove('hidden');
        }
        function closeEditModal() { document.getElementById('editModal').classList.add('hidden'); }
        
        function saveEditData() {
            const id = parseInt(document.getElementById('editId').value);
            const index = db_surat.findIndex(s => s.id === id);
            if(index !== -1) {
                db_surat[index].perihal = document.getElementById('editPerihal').value;
                db_surat[index].dari = document.getElementById('editDari').value;
                db_surat[index].kepada = document.getElementById('editKepada').value;
                db_surat[index].status = document.getElementById('editStatus').value;
                db_surat[index].hasFile = document.getElementById('editFileStatus').value === "true";
                
                localStorage.setItem('db_surat_v35', JSON.stringify(db_surat));
                alert("Data berhasil direvisi!");
                closeEditModal();
                renderTable(); renderChart(); // Refresh UI
            }
        }

        function openViewModal(id) {
            const item = db_surat.find(s => s.id === id);
            if(!item) return;
            const content = document.getElementById('viewModalContent');
            const fileStatus = item.hasFile ? 
                `<span class="text-green-600 font-bold"><i class="fa-solid fa-check-circle"></i> Uploaded</span>` : 
                `<span class="text-red-500 font-bold"><i class="fa-solid fa-exclamation-circle"></i> Not Uploaded</span>`;
            
            content.innerHTML = `
                <div class="grid grid-cols-3 gap-4 text-sm">
                    <div class="text-gray-500">Nomor Surat</div><div class="col-span-2 font-bold text-blue-800">${item.nomor}</div>
                    <div class="text-gray-500">Tanggal</div><div class="col-span-2 font-mono">${item.tanggal}</div>
                    <div class="text-gray-500">Jenis / Kategori</div><div class="col-span-2">${item.jenis} (${item.kategori})</div>
                    <div class="text-gray-500">Arah Surat</div><div class="col-span-2">${item.arah}</div>
                    <div class="text-gray-500">Dari</div><div class="col-span-2">${item.dari}</div>
                    <div class="text-gray-500">Kepada</div><div class="col-span-2">${item.kepada}</div>
                    <div class="text-gray-500">Perihal</div><div class="col-span-2 p-2 bg-gray-50 rounded border">${item.perihal}</div>
                    <div class="text-gray-500">Status</div><div class="col-span-2"><span class="px-2 py-1 rounded bg-blue-100 text-blue-800 text-xs font-bold">${item.status}</span></div>
                    <div class="text-gray-500">Lampiran</div><div class="col-span-2">${fileStatus}</div>
                </div>
            `;
            document.getElementById('viewModal').classList.remove('hidden');
        }
        function closeViewModal() { document.getElementById('viewModal').classList.add('hidden'); }

        // --- CALENDAR LOGIC ---
        function toggleCalendarModal() {
            const modal = document.getElementById('calendarModal');
            if (modal.classList.contains('hidden')) { modal.classList.remove('hidden'); renderCalendar(); } 
            else { modal.classList.add('hidden'); }
        }
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthYearLabel = document.getElementById('calMonthYear');
            grid.innerHTML = "";
            const year = calDate.getFullYear(); const month = calDate.getMonth();
            monthYearLabel.innerText = calDate.toLocaleString(currentLang==='id'?'id-ID':'en-US', { month: 'long', year: 'numeric' });
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            for(let i=0; i<firstDay; i++) grid.appendChild(document.createElement('div'));
            for(let d=1; d<=daysInMonth; d++) {
                const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const cell = document.createElement('div');
                cell.className = 'cal-day'; cell.innerText = d;
                if(db_surat.some(s => s.tanggal === dateStr)) cell.classList.add('has-data');
                if(activeFilterDate === dateStr) cell.classList.add('active');
                cell.onclick = () => { activeFilterDate = dateStr; resetPaginationAndRender(); toggleCalendarModal(); updateMiniWidgetLabel(); };
                grid.appendChild(cell);
            }
        }
        function changeMonth(delta) { calDate.setMonth(calDate.getMonth() + delta); renderCalendar(); }
        function clearDateFilter() { activeFilterDate = null; renderCalendar(); resetPaginationAndRender(); updateMiniWidgetLabel(); }
        function updateMiniWidgetLabel() {
            const label = document.getElementById('calWidgetLabel');
            if (activeFilterDate) {
                const d = new Date(activeFilterDate);
                label.innerHTML = `<span class="text-blue-600 font-bold">${d.toLocaleDateString(currentLang==='id'?'id-ID':'en-US', { day: 'numeric', month: 'short' })}</span>`;
            } else { label.innerText = currentLang === 'id' ? 'Filter Tanggal' : 'Date Filter'; }
        }

        // --- RENDER TABLE & LOGIC ---
        function resetPaginationAndRender() { currentPage = 1; renderTable(); }
        function changePage(delta) { currentPage += delta; renderTable(); }
        function changeRowsPerPage() { rowsPerPage = parseInt(document.getElementById('rowsPerPage').value); currentPage = 1; renderTable(); }

        function renderTable() {
            const tbody = document.getElementById('dataTableBody');
            const searchVal = document.getElementById('searchInput').value.toLowerCase();
            const filterArah = document.getElementById('filterArah').value;
            const filterStatus = document.getElementById('filterStatus').value;
            const filterKategori = document.getElementById('filterKategori').value;

            tbody.innerHTML = '';
            const filtered = db_surat.filter(item => {
                const matchSearch = item.nomor.toLowerCase().includes(searchVal) || item.perihal.toLowerCase().includes(searchVal);
                const matchArah = filterArah === 'All' || item.arah === filterArah;
                const matchStatus = filterStatus === 'All' || item.status === filterStatus;
                const matchCat = filterKategori === 'All' || item.kategori === filterKategori;
                const matchDate = !activeFilterDate || item.tanggal === activeFilterDate;
                return matchSearch && matchArah && matchStatus && matchCat && matchDate;
            });

            const totalItems = filtered.length;
            const totalPages = Math.ceil(totalItems / rowsPerPage);
            if(currentPage > totalPages) currentPage = totalPages || 1;
            const start = (currentPage - 1) * rowsPerPage;
            const paginated = filtered.slice(start, start + rowsPerPage);

            document.getElementById('stat-total').innerText = db_surat.length;
            document.getElementById('stat-in').innerText = db_surat.filter(s => s.arah === 'Masuk').length;
            document.getElementById('stat-out').innerText = db_surat.filter(s => s.arah === 'Keluar').length;

            if(paginated.length === 0) {
                document.getElementById('emptyState').classList.remove('hidden');
                document.getElementById('emptyState').classList.add('flex');
                document.getElementById('dateFilterMsg').classList.toggle('hidden', !activeFilterDate);
            } else {
                document.getElementById('emptyState').classList.add('hidden');
                document.getElementById('emptyState').classList.remove('flex');

                paginated.forEach(row => {
                    let stClass = "status-draft";
                    if(row.status==='Sent') stClass="status-sent";
                    if(row.status==='Received') stClass="status-received";
                    if(row.status==='Disposisi') stClass="status-disposition";
                    if(row.status==='Done') stClass="status-done";

                    const iconArah = row.arah === 'Masuk' 
                        ? `<i class="fa-solid fa-arrow-down text-yellow-600 bg-yellow-100 p-1 rounded-full text-[10px]"></i>` 
                        : `<i class="fa-solid fa-arrow-up text-blue-600 bg-blue-100 p-1 rounded-full text-[10px]"></i>`;
                    
                    const fileIcon = row.hasFile 
                        ? `<i class="fa-solid fa-paperclip text-blue-500 text-sm" title="Ada File"></i>` 
                        : `<i class="fa-solid fa-minus text-gray-300 text-xs"></i>`;

                    const tr = document.createElement('tr');
                    tr.className = "bg-white hover:bg-gray-50 transition border-b border-gray-100 cursor-pointer";
                    // Click row triggers view details
                    tr.onclick = (e) => {
                        // Prevent if clicking specific buttons
                        if(e.target.closest('.edit-btn')) return;
                        openViewModal(row.id);
                    };

                    tr.innerHTML = `
                        <td class="px-4 py-3 text-center">${iconArah}</td>
                        <td class="px-4 py-3 font-medium text-blue-600 whitespace-nowrap text-xs hover:underline">${row.nomor}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-xs text-gray-500 font-mono">${row.tanggal}</td>
                        <td class="px-4 py-3 text-gray-700 truncate max-w-xs text-xs">${row.perihal}</td>
                        <td class="px-4 py-3 text-xs text-gray-500">${row.jenis}</td>
                        <td class="px-4 py-3 text-center">${fileIcon}</td>
                        <td class="px-4 py-3 text-center"><span class="px-2 py-0.5 rounded text-[10px] border ${stClass}">${row.status}</span></td>
                        <td class="px-4 py-3 text-center">
                            <button onclick="event.stopPropagation(); openEditModal(${row.id})" class="edit-btn text-gray-400 hover:text-amber-500 transition"><i class="fa-solid fa-pen-to-square"></i></button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            }
            const infoText = currentLang === 'id' 
                ? `${totalItems===0?0:start+1}-${Math.min(start+rowsPerPage, totalItems)} dari ${totalItems} data` 
                : `${totalItems===0?0:start+1}-${Math.min(start+rowsPerPage, totalItems)} of ${totalItems} records`;
            document.getElementById('paginationInfo').innerText = infoText;
            document.getElementById('btnPrev').disabled = currentPage === 1;
            document.getElementById('btnNext').disabled = currentPage >= totalPages || totalPages === 0;
        }

        // --- MAIN FUNCTIONS ---
        function handleSimpan(e) {
            e.preventDefault();
            // ... (Simplified for brevity, logic remains same) ...
            const arah = document.getElementById('inputArah').value;
            const kategori = document.getElementById('inputKategori').value;
            const jenis = document.getElementById('inputJenis').value;
            const tanggal = document.getElementById('inputTanggal').value;
            const perihal = document.getElementById('inputPerihal').value;
            const dari = document.getElementById('inputDari').value;
            const kepada = document.getElementById('inputKepada').value;
            const status = document.getElementById('inputStatus').value;
            const unit = document.getElementById('inputUnit').value;

            if(!kategori || !jenis) { alert("Data tidak lengkap!"); return; }

            const newData = {
                id: Date.now(),
                nomor: generateNomorSurat(kategori, jenis, tanggal),
                kategori, jenis, arah, tanggal, perihal, dari, kepada, status, unit,
                hasFile: true // Assume upload success for demo
            };

            db_surat.unshift(newData);
            localStorage.setItem('db_surat_v35', JSON.stringify(db_surat));
            alert(currentLang==='id' ? "Data Tersimpan!" : "Saved!");
            document.getElementById('suratForm').reset();
            document.getElementById('inputTanggal').valueAsDate = new Date();
            
            if(activeFilterDate === tanggal) resetPaginationAndRender();
            else { renderCalendar(); renderChart(); }
        }

        function resetDatabase() {
            if(confirm("Reset Demo Data?")) {
                generateDummyData(); activeFilterDate = null; updateMiniWidgetLabel();
                renderCalendar(); resetPaginationAndRender(); renderChart();
            }
        }

        function changeLanguage(lang) {
            currentLang = lang;
            const btnId = document.getElementById('btn-lang-id');
            const btnEn = document.getElementById('btn-lang-en');
            if(lang === 'id') {
                btnId.className = "px-2 py-0.5 text-[10px] font-bold rounded bg-blue-600 text-white transition";
                btnEn.className = "px-2 py-0.5 text-[10px] font-bold rounded text-gray-400 hover:text-white transition";
            } else {
                btnEn.className = "px-2 py-0.5 text-[10px] font-bold rounded bg-blue-600 text-white transition";
                btnId.className = "px-2 py-0.5 text-[10px] font-bold rounded text-gray-400 hover:text-white transition";
            }
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(TRANSLATIONS[key]) el.innerHTML = TRANSLATIONS[key][lang];
            });
            renderCalendar(); renderTable(); renderChart(); updateMiniWidgetLabel();
        }

        // --- CHART & EXPORT ---
        function renderChart() {
            const ctx = document.getElementById('trafficChart').getContext('2d');
            const range = parseInt(document.getElementById('chartFilter').value);
            const labels = [], dataMasuk = [], dataKeluar = [];
            const today = new Date();
            for (let i = range - 1; i >= 0; i--) {
                const d = new Date(today.getFullYear(), today.getMonth() - i, 1);
                labels.push(d.toLocaleString(currentLang==='id'?'id-ID':'en-US', { month: 'short' }));
                const mStr = d.toISOString().slice(0, 7);
                dataMasuk.push(db_surat.filter(s => s.arah === 'Masuk' && s.tanggal.startsWith(mStr)).length);
                dataKeluar.push(db_surat.filter(s => s.arah === 'Keluar' && s.tanggal.startsWith(mStr)).length);
            }
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: currentLang==='id'?'Masuk':'Incoming', data: dataMasuk, borderColor: '#EAB308', backgroundColor: 'rgba(234, 179, 8, 0.1)', borderWidth: 2, tension: 0.4, fill: true },
                        { label: currentLang==='id'?'Keluar':'Outgoing', data: dataKeluar, borderColor: '#1F2937', backgroundColor: 'rgba(31, 41, 55, 0.1)', borderWidth: 2, tension: 0.4, fill: true }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: true }, x: { grid: { display: false } } } }
            });
        }

        function exportExcel() {
            const data = db_surat.map(i => ({ "No":i.nomor, "Date":i.tanggal, "Subj":i.perihal, "From":i.dari, "To":i.kepada }));
            const ws = XLSX.utils.json_to_sheet(data); const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Arsip"); XLSX.writeFile(wb, "Arsip.xlsx");
        }
        function exportPDF() {
            const { jsPDF } = window.jspdf; const doc = new jsPDF('l');
            doc.text("Arsip Report", 14, 15);
            doc.autoTable({ head: [['No','Date','Subject']], body: db_surat.map(r=>[r.nomor,r.tanggal,r.perihal]), startY: 20 });
            doc.save("Arsip.pdf");
        }
    </script>
</body>
</html>